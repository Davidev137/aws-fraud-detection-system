# AWS CLI commands to set up the fraud detection system infrastructure

# 1. Kinesis Data Stream (1 Shard for cost-effectiveness)
aws kinesis create-stream \
  --stream-name fraud-detection-stream \
  --shard-count 1 \
  --region us-east-1

# 2. S3 Bucket (Data Lake)
# Note: Bucket names must be globally unique. Replace 'your-unique-bucket-name'
aws s3api create-bucket \
  --bucket your-unique-bucket-name-fraud-detection \
  --region us-east-1

# 3. DynamoDB Tables (On-Demand mode for serverless scaling and cost savings)

# UserProfileTable: Stores user's transaction history and state
aws dynamodb create-table \
  --table-name UserProfileTable \
  --attribute-definitions AttributeName=userId,AttributeType=S \
  --key-schema AttributeName=userId,KeyType=HASH \
  --billing-mode PAY_PER_REQUEST \
  --region us-east-1

# UserGraphTable: Simulates graph relationships (e.g., shared IPs, devices)
aws dynamodb create-table \
  --table-name UserGraphTable \
  --attribute-definitions AttributeName=nodeId,AttributeType=S AttributeName=relatedNodeId,AttributeType=S \
  --key-schema AttributeName=nodeId,KeyType=HASH AttributeName=relatedNodeId,KeyType=RANGE \
  --billing-mode PAY_PER_REQUEST \
  --region us-east-1

# FraudCasesTable: Stores details of detected fraud cases and their SHAP explanations
aws dynamodb create-table \
  --table-name FraudCasesTable \
  --attribute-definitions AttributeName=caseId,AttributeType=S \
  --key-schema AttributeName=caseId,KeyType=HASH \
  --billing-mode PAY_PER_REQUEST \
  --region us-east-1

# 4. Kinesis Data Firehose (to load raw data from Stream to S3)
# Note: This requires an IAM role with permissions. The role is defined in iam_policies.json
aws firehose create-delivery-stream \
  --delivery-stream-name fraud-detection-firehose \
  --delivery-stream-type KinesisStreamAsSource \
  --kinesis-stream-source-configuration KinesisStreamARN="arn:aws:kinesis:us-east-1:ACCOUNT_ID:stream/fraud-detection-stream",RoleARN="arn:aws:iam::ACCOUNT_ID:role/FirehoseDeliveryRole" \
  --extended-s3-destination-configuration \
    RoleARN="arn:aws:iam::ACCOUNT_ID:role/FirehoseDeliveryRole",\
    BucketARN="arn:aws:s3:::your-unique-bucket-name-fraud-detection",\
    Prefix="transactions/raw/"
